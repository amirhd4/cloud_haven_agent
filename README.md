# Cloud Haven Agent

این یک کلاینت (Agent) قدرتمند و امن برای سیستم مدیریت پشتیبان‌گیری متمرکز Cloud Haven است. این اسکریپت بر روی سرورهای مقصد نصب شده و وظیفه اجرای عملیات پشتیبان‌گیری، رمزگذاری داده‌ها، و ارتباط با سرور مرکزی را بر عهده دارد.

## ویژگی‌های کلیدی

- **پشتیبانی از چند دیتابیس:** معماری ماژولار مبتنی بر درایور برای پشتیبانی آسان از دیتابیس‌های مختلف (در حال حاضر PostgreSQL و MySQL).
- **رمزگذاری سرتاسری (End-to-End):** تمام فایل‌های بکاپ قبل از خروج از سرور کلاینت، با استفاده از کلید رمزگذاری اختصاصی، قفل می‌شوند.
- **کنترل از راه دور:** قابلیت دریافت و اجرای فرمان‌های فوری (بکاپ/بازیابی) از طریق داشبوردهای وب.
- **زمان‌بندی پویا:** دریافت و اعمال زمان‌بندی‌های خودکار از سرور مرکزی به صورت آنی.
- **سازگاری با سیستم‌عامل‌های مختلف:** قابلیت تعریف مسیر ابزارهای دیتابیس برای سازگاری با ویندوز و لینوکس.

## راه‌اندازی و نصب

### ۱. کلون کردن ریپازیتوری:
```bash
git clone [آدرس-ریپازیتوری-شما]
cd cloud_haven_agent
```

### ۲. ایجاد و فعال‌سازی محیط مجازی:
```bash
python -m venv .venv
source .venv/bin/activate  # On Windows: .venv\Scripts\activate
```

### ۳. نصب وابستگی‌ها:
```bash
pip install -r requirements.txt
```

### ۴. پیکربندی اولیه:
یک فایل `client_config.ini` در کنار اسکریپت `client_agent.py` بسازید. این فایل باید شامل توکن دریافتی از ادمین سرور باشد.

```ini
[Auth]
AccessToken = eyJhbGciOiJIUzI1Ni...
```

### ۵. ایجاد کلید رمزگذاری (فقط یک بار):
برای امنیت کامل، یک کلید رمزگذاری محلی ایجاد کنید. این کلید هرگز از این ماشین خارج نمی‌شود.

```bash
python client_agent.py generate-key
```
این دستور کلید را به فایل `client_config.ini` اضافه می‌کند.

---

## نحوه استفاده

### حالت سرویس (Listen)
این حالت اصلی کار است. کلاینت به طور دائم در حال اجرا باقی مانده، به سرور متصل می‌شود و منتظر دریافت فرمان‌ها و اجرای زمان‌بندی‌های خودکار است.

```bash
python client_agent.py listen
```

### حالت اجرای دستی
شما می‌توانید عملیات‌ها را به صورت دستی نیز اجرا کنید.

```bash
# ایجاد یک بکاپ از جاب 'pg_main'
python client_agent.py run-backup --job pg_main

# لیست کردن بکاپ‌های جاب 'pg_main'
python client_agent.py run-list --job pg_main

# بازیابی یک فایل بکاپ
python client_agent.py run-restore --job pg_main --file "backup_file_name.sql.gz.enc"
```

---

## چگونه ریپازیتوری گیت‌هاب را فقط-خواندنی (Read-only) کنیم؟

شما می‌خواهید کدها قابل مشاهده باشند، اما کسی (حتی خودتان) نتواند در آن‌ها تغییری ایجاد کند. بهترین و استانداردترین راه برای این کار در گیت‌هاب، **آرشیو کردن ریپازیتوری (Archiving)** است.

### آرشیو کردن چه کاری انجام می‌دهد؟
- کل پروژه به همراه تمام کدها، تاریخچه و ... به صورت فقط-خواندنی باقی می‌ماند.
- دیگر نمی‌توان در آن `push` کرد.
- دیگر نمی‌توان Issue یا Pull Request جدید ایجاد کرد.

### مراحل آرشیو کردن:
1. به صفحه اصلی ریپازیتوری خود در گیت‌هاب بروید.
2. روی تب **Settings** کلیک کنید.
3. در همان صفحه اول (General)، به پایین اسکرول کنید تا به بخش **"Danger Zone"** برسید.
4. آخرین گزینه در این بخش، **"Archive this repository"** است. روی آن کلیک کرده و دستورالعمل‌ها را دنبال کنید (از شما می‌خواهد نام ریپازیتوری را برای تأیید تایپ کنید).

پس از این کار، پروژه شما برای همیشه به صورت فقط-خواندنی در خواهد آمد (البته امکان از آرشیو خارج کردن آن نیز وجود دارد).
# Cloud Haven Agent

این یک کلاینت (Agent) قدرتمند و امن برای سیستم مدیریت پشتیبان‌گیری متمرکز Cloud Haven است. این اسکریپت بر روی سرورهای مقصد نصب شده و وظیفه اجرای عملیات پشتیبان‌گیری، رمزگذاری داده‌ها، و ارتباط با سرور مرکزی را بر عهده دارد.

## ویژگی‌های کلیدی

- **پشتیبانی از چند دیتابیس:** معماری ماژولار مبتنی بر درایور برای پشتیبانی آسان از دیتابیس‌های مختلف (در حال حاضر PostgreSQL و MySQL).
- **رمزگذاری سرتاسری (End-to-End):** تمام فایل‌های بکاپ قبل از خروج از سرور کلاینت، با استفاده از کلید رمزگذاری اختصاصی، قفل می‌شوند.
- **کنترل از راه دور:** قابلیت دریافت و اجرای فرمان‌های فوری (بکاپ/بازیابی) از طریق داشبوردهای وب.
- **زمان‌بندی پویا:** دریافت و اعمال زمان‌بندی‌های خودکار از سرور مرکزی به صورت آنی.
- **سازگاری با سیستم‌عامل‌های مختلف:** قابلیت تعریف مسیر ابزارهای دیتابیس برای سازگاری با ویندوز و لینوکس.

## راه‌اندازی و نصب

### ۱. کلون کردن ریپازیتوری:
```bash
git clone [آدرس-ریپازیتوری-شما]
cd cloud_haven_agent
```

### ۲. ایجاد و فعال‌سازی محیط مجازی:
```bash
python -m venv .venv
source .venv/bin/activate  # On Windows: .venv\Scripts\activate
```

### ۳. نصب وابستگی‌ها:
```bash
pip install -r requirements.txt
```

### ۴. پیکربندی اولیه:
یک فایل `client_config.ini` در کنار اسکریپت `client_agent.py` بسازید. این فایل باید شامل توکن دریافتی از ادمین سرور باشد.

```ini
[Auth]
AccessToken = eyJhbGciOiJIUzI1Ni...
```

### ۵. ایجاد کلید رمزگذاری (فقط یک بار):
برای امنیت کامل، یک کلید رمزگذاری محلی ایجاد کنید. این کلید هرگز از این ماشین خارج نمی‌شود.

```bash
python client_agent.py generate-key
```
این دستور کلید را به فایل `client_config.ini` اضافه می‌کند.

---

## نحوه استفاده

### حالت سرویس (Listen)
این حالت اصلی کار است. کلاینت به طور دائم در حال اجرا باقی مانده، به سرور متصل می‌شود و منتظر دریافت فرمان‌ها و اجرای زمان‌بندی‌های خودکار است.

```bash
python client_agent.py listen
```

### حالت اجرای دستی
شما می‌توانید عملیات‌ها را به صورت دستی نیز اجرا کنید.

```bash
# ایجاد یک بکاپ از جاب 'pg_main'
python client_agent.py run-backup --job pg_main

# لیست کردن بکاپ‌های جاب 'pg_main'
python client_agent.py run-list --job pg_main

# بازیابی یک فایل بکاپ
python client_agent.py run-restore --job pg_main --file "backup_file_name.sql.gz.enc"
```